<!DOCTYPE html>
<html>

    {include file="common/head"/}
    </head>

    <body>
        <div class="wrapper">
            <div class="container">
                <form class="account-form" id="form2">
                    <div class="account-form-group">
                        <div class="headline">
                            <p>绑定手机号</p>
                        </div>
                    </div>
                    <div class="account-form-group">
                        <input class="account-form-control form-input" id="phone" type="tel" maxlength="11" placeholder="请输入手机号">
                        <div class="account-form-guide account-form-clear">
                            <a href="#"><img class="icon" src="img/img13.png"></img>
                            </a>
                        </div>
                    </div>
                    <div class="account-form-group">
                        <input type="text" maxlength="4" class="account-form-control form-input" id="pass-code" placeholder="请输入验证码">
                        <div class="account-form-guide account-form-validate">
                            <a class="validate-btn " href="javascript:void(0);" id="code-btn">获取验证码</a>
                        </div>
                    </div>

                    <div class="account-form-group button-row">
                        <a class="account-btn off" href="javascript:void(0);" onClick="submitBtn()">绑定手机号码</a>
                    </div>
                    <div class="account-form-group  err-tips-box" >
                        <div class="err-tips" id="errMsg" style="display:none;"></div>
                    </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        
        $('#code-btn').click(function(){
            var phone = $('#phone').val();
            var pattern = /^1[34578]\d{9}$/;
            if (!pattern.test(phone)) {
                errMsg("手机号码格式不正确");
                return false;
            } else {
                //检测该手机号是否已绑定
                $.ajax({
                    url:"{:url('Smscode/send')}",
                    type:'post',
                    dataType:'json',
                    data:{phone:phone,type:1},
                    success:function(data){
                        if (data.code == 1) {
                            errMsg(data.msg);
                            settime();
                        } else {
                            errMsg(data.msg);
                        }
                    }
                });
            }
        });
        
        
        var countdown = 60;
        function settime() {
            if(countdown == 0) {
                $('#code-btn').html("获取验证码");
                countdown = 60;
                return;
            } else {
                $('#code-btn').html("重新发送("+countdown+")");
                countdown--;
            }
            setTimeout(function(){
                settime();
            },1000);
        }
        
        
        function errMsg(txt) {
            $('#errMsg').html(txt);    
            $('#errMsg').fadeIn();    
            setTimeout(function() {    
                $('#errMsg').fadeOut();    
            }, 2000);
        }
         

    </script>
</body>

</html>